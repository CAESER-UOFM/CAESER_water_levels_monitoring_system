(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[892],{803:function(){},660:function(e,t,a){Promise.resolve().then(a.bind(a,9207))},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},9207:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var s=a(7437),l=a(2265),r=a(9376),n=a(880),i=a(336);function o(e){let{databaseId:t,onWellSelected:a}=e,[r,o]=(0,l.useState)([]),[c,d]=(0,l.useState)(!0),[u,m]=(0,l.useState)(null),[h,x]=(0,l.useState)(""),[p,g]=(0,l.useState)(""),[b,f]=(0,l.useState)(void 0),[w,_]=(0,l.useState)("well_number"),[N,j]=(0,l.useState)("asc"),[y,v]=(0,l.useState)(1),[E,k]=(0,l.useState)(1),[C,L]=(0,l.useState)(0),D=(0,l.useMemo)(()=>Array.from(new Set(r.map(e=>e.well_field).filter(Boolean))).sort(),[r]),O=(0,l.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{d(!0),m(null);let a=n.f4.getDatabase(t);if(!a)throw Error("Database not available");let s=await a.getWells({...e,page:y,limit:20});if(s.success&&s.data)o(s.data),k(s.pagination.totalPages),L(s.pagination.total);else throw Error(s.error||"Failed to load wells")}catch(e){console.error("Error loading wells:",e),m(e instanceof Error?e.message:"Failed to load wells"),o([])}finally{d(!1)}},[t,y,20]);(0,l.useEffect)(()=>{O({search:h||void 0,field:p||void 0,hasData:b,sortBy:w,sortOrder:N})},[O,h,p,b,w,N]),(0,l.useEffect)(()=>{v(1)},[h,p,b]);let R=(0,l.useCallback)(e=>{x(e)},[]),S=(0,l.useCallback)(e=>{g(e)},[]),T=(0,l.useCallback)(e=>{f(""===e?void 0:"true"===e)},[]),W=(0,l.useCallback)(e=>{w===e?j(e=>"asc"===e?"desc":"asc"):(_(e),j("asc"))},[w]),A=(0,l.useCallback)(e=>{v(e)},[]),M=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"No data",z=e=>w!==e?(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9l4-4 4 4m0 6l-4 4-4-4"})}):"asc"===N?(0,s.jsx)("svg",{className:"w-4 h-4 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 15l4-4 4 4"})}):(0,s.jsx)("svg",{className:"w-4 h-4 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 9l-4 4-4-4"})});return u?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("svg",{className:"w-16 h-16 text-red-500 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"})}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Loading Wells"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:u}),(0,s.jsx)("button",{onClick:()=>O(),className:"btn-primary",children:"Try Again"})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Well Browser"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search Wells"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",value:h,onChange:e=>R(e.target.value),placeholder:"Well number, CAE, field...",className:"input-field pl-10"}),(0,s.jsx)("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Well Field"}),(0,s.jsxs)("select",{value:p,onChange:e=>S(e.target.value),className:"input-field",children:[(0,s.jsx)("option",{value:"",children:"All Fields"}),D.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Availability"}),(0,s.jsxs)("select",{value:void 0===b?"":b.toString(),onChange:e=>T(e.target.value),className:"input-field",children:[(0,s.jsx)("option",{value:"",children:"All Wells"}),(0,s.jsx)("option",{value:"true",children:"With Data"}),(0,s.jsx)("option",{value:"false",children:"No Data"})]})]}),(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,s.jsx)("span",{className:"font-medium",children:C})," wells found",E>1&&(0,s.jsxs)("span",{className:"block text-xs",children:["Page ",y," of ",E]})]})})]})]}),(0,s.jsxs)("div",{className:"card",children:[c?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(i.T,{size:"large"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading wells..."})]}):0===r.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("svg",{className:"w-16 h-16 text-gray-300 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Wells Found"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Try adjusting your search criteria or filters"})]}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 mobile-touch-target",onClick:()=>W("well_number"),children:(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsx)("span",{children:"Well Number"}),z("well_number")]})}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 mobile-touch-target",onClick:()=>W("cae_number"),children:(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsx)("span",{children:"CAE Number"}),z("cae_number")]})}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Field"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Readings"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 mobile-touch-target",onClick:()=>W("last_reading_date"),children:(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsx)("span",{children:"Last Reading"}),z("last_reading_date")]})}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>a(e),children:[(0,s.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.well_number}),(0,s.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:e.cae_number||"—"}),(0,s.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:e.well_field||"—"}),(0,s.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("span",{className:"font-medium",children:e.total_readings||0}),(0,s.jsxs)("div",{className:"flex space-x-1",children:[e.has_transducer_data&&(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",title:"Has transducer data",children:"T"}),e.has_manual_readings&&(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",title:"Has manual readings",children:"M"}),e.has_telemetry_data&&(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",title:"Has telemetry data",children:"Tel"})]})]})}),(0,s.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:M(e.last_reading_date)}),(0,s.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),a(e)},className:"text-primary-600 hover:text-primary-800 font-medium mobile-touch-target",children:"View Data →"})})]},e.well_number))})]})}),E>1&&(0,s.jsxs)("div",{className:"flex items-center justify-between border-t border-gray-200 bg-gray-50 px-4 py-3 sm:px-6",children:[(0,s.jsxs)("div",{className:"flex justify-between sm:hidden",children:[(0,s.jsx)("button",{onClick:()=>A(y-1),disabled:1===y,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,s.jsx)("button",{onClick:()=>A(y+1),disabled:y===E,className:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),(0,s.jsxs)("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing"," ",(0,s.jsx)("span",{className:"font-medium",children:(y-1)*20+1})," ","to"," ",(0,s.jsx)("span",{className:"font-medium",children:Math.min(20*y,C)})," ","of"," ",(0,s.jsx)("span",{className:"font-medium",children:C})," ","results"]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination",children:[(0,s.jsx)("button",{onClick:()=>A(y-1),disabled:1===y,className:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,s.jsx)("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z",clipRule:"evenodd"})})}),Array.from({length:Math.min(5,E)},(e,t)=>{let a=t+1;return(0,s.jsx)("button",{onClick:()=>A(a),className:"relative inline-flex items-center px-4 py-2 text-sm font-semibold ".concat(y===a?"z-10 bg-primary-600 text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"),children:a},a)}),(0,s.jsx)("button",{onClick:()=>A(y+1),disabled:y===E,className:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,s.jsx)("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"})})})]})})]})]})]})]})}function c(){let e=(0,r.useParams)(),t=(0,r.useRouter)(),a=e.id,[c,d]=(0,l.useState)(null),[u,m]=(0,l.useState)(!0),[h,x]=(0,l.useState)(null);(0,l.useEffect)(()=>((async()=>{try{m(!0),x(null);let e=localStorage.getItem("uploaded_databases");if(!e)throw Error("No databases found");let t=JSON.parse(e).find(e=>e.id===a);if(!t)throw Error("Database not found");d(t);let s=localStorage.getItem("db_".concat(a));if(!s)throw Error("Database data not found");let l=JSON.parse(s),r=new Uint8Array(l).buffer;await n.f4.loadDatabase(a,r)}catch(e){console.error("Error loading database:",e),x(e instanceof Error?e.message:"Failed to load database")}finally{m(!1)}})(),()=>{n.f4.closeDatabase(a)}),[a]);let p=(0,l.useCallback)(e=>{t.push("/wells/".concat(a,"/plot/").concat(e.well_number))},[a,t]),g=(0,l.useCallback)(()=>{t.push("/")},[t]);return u?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(i.T,{size:"large"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading database..."})]})}):h?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center max-w-md mx-auto px-4",children:[(0,s.jsx)("svg",{className:"w-16 h-16 text-red-500 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"})}),(0,s.jsx)("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Database Error"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:h}),(0,s.jsx)("button",{onClick:g,className:"btn-primary",children:"← Back to Databases"})]})}):c?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("button",{onClick:g,className:"p-2 text-gray-600 hover:text-gray-900 transition-colors mobile-touch-target",title:"Back to databases",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:c.name}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[c.wellsCount," wells available"]})]})]}),(0,s.jsxs)("div",{className:"hidden sm:flex items-center space-x-2 text-sm text-gray-500",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"})}),(0,s.jsx)("span",{children:"Database"})]})]})})}),(0,s.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,s.jsx)(o,{databaseId:a,onWellSelected:p})})]}):null}},336:function(e,t,a){"use strict";a.d(t,{T:function(){return l}});var s=a(7437);function l(e){let{size:t="medium",className:a=""}=e;return(0,s.jsx)("div",{className:"loading-spinner ".concat({small:"w-4 h-4",medium:"w-8 h-8",large:"w-12 h-12"}[t]," ").concat(a)})}},880:function(e,t,a){"use strict";a.d(t,{TD:function(){return i},f4:function(){return c}});var s=a(919),l=a.n(s);let r=null;async function n(){if(!r)try{r=await l()({locateFile:e=>"https://sql.js.org/dist/".concat(e)})}catch(e){throw console.error("Failed to initialize sql.js:",e),Error("Database initialization failed")}}class i{async initialize(){if(!this.initialized){if(await n(),!r)throw Error("SQL.js not initialized");try{this.db=new r.Database(new Uint8Array(this.arrayBuffer)),this.initialized=!0,await this.validateSchema()}catch(e){throw console.error("Failed to open database:",e),Error("Invalid database file")}}}async validateSchema(){if(!this.db)throw Error("Database not initialized");let e=this.db.prepare('SELECT name FROM sqlite_master WHERE type="table"'),t=[];for(;e.step();){let a=e.getAsObject();t.push(a.name)}for(let a of(e.free(),["wells","water_level_readings"]))if(!t.includes(a))throw Error("Required table '".concat(a,"' not found in database"))}async getWells(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.db)throw Error("Database not initialized");let{search:t="",field:a="",hasData:s,page:l=1,limit:r=50,sortBy:n="well_number",sortOrder:i="asc"}=e,o="\n      SELECT \n        w.*,\n        COUNT(wlr.id) as total_readings,\n        MAX(wlr.timestamp_utc) as last_reading_date,\n        CASE WHEN COUNT(mr.id) > 0 THEN 1 ELSE 0 END as has_manual_readings,\n        CASE WHEN COUNT(wlr.id) > 0 THEN 1 ELSE 0 END as has_transducer_data\n      FROM wells w\n      LEFT JOIN water_level_readings wlr ON w.well_number = wlr.well_number\n      LEFT JOIN manual_readings mr ON w.well_number = mr.well_number\n      WHERE 1=1\n    ",c=[];if(t){o+=" AND (w.well_number LIKE ? OR w.cae_number LIKE ? OR w.well_field LIKE ?)";let e="%".concat(t,"%");c.push(e,e,e)}a&&(o+=" AND w.well_field = ?",c.push(a)),void 0!==s&&(s?o+=" AND COUNT(wlr.id) > 0":o+=" AND COUNT(wlr.id) = 0"),o+=" GROUP BY w.well_number",["well_number","cae_number","last_reading_date"].includes(n)&&(o+=" ORDER BY ".concat(n," ").concat(i.toUpperCase())),o+=" LIMIT ? OFFSET ?",c.push(r,(l-1)*r);try{let e=this.db.prepare(o);e.bind(c);let s=[];for(;e.step();){let t=e.getAsObject();s.push(this.mapRowToWell(t))}e.free();let n="\n        SELECT COUNT(DISTINCT w.well_number) as total\n        FROM wells w\n        LEFT JOIN water_level_readings wlr ON w.well_number = wlr.well_number\n        WHERE 1=1\n      ",i=[];if(t){n+=" AND (w.well_number LIKE ? OR w.cae_number LIKE ? OR w.well_field LIKE ?)";let e="%".concat(t,"%");i.push(e,e,e)}a&&(n+=" AND w.well_field = ?",i.push(a));let d=this.db.prepare(n);d.bind(i),d.step();let u=d.getAsObject().total;return d.free(),{success:!0,data:s,pagination:{page:l,limit:r,total:u,totalPages:Math.ceil(u/r)}}}catch(e){throw console.error("Error fetching wells:",e),Error("Failed to fetch wells data")}}async getWell(e){if(!this.db)throw Error("Database not initialized");let t=this.db.prepare("\n      SELECT \n        w.*,\n        COUNT(wlr.id) as total_readings,\n        MAX(wlr.timestamp_utc) as last_reading_date,\n        CASE WHEN COUNT(mr.id) > 0 THEN 1 ELSE 0 END as has_manual_readings,\n        CASE WHEN COUNT(wlr.id) > 0 THEN 1 ELSE 0 END as has_transducer_data\n      FROM wells w\n      LEFT JOIN water_level_readings wlr ON w.well_number = wlr.well_number\n      LEFT JOIN manual_readings mr ON w.well_number = mr.well_number\n      WHERE w.well_number = ?\n      GROUP BY w.well_number\n    ");if(t.bind([e]),t.step()){let e=t.getAsObject();return t.free(),this.mapRowToWell(e)}return t.free(),null}async getWaterLevelData(e){if(!this.db)throw Error("Database not initialized");let{wellNumber:t,startDate:a,endDate:s,dataType:l="all",downsample:r=!1,maxPoints:n=1e3}=e,i="\n      SELECT \n        id,\n        well_number,\n        timestamp_utc,\n        julian_timestamp,\n        water_level,\n        temperature,\n        dtw,\n        'transducer' as data_source,\n        baro_flag,\n        level_flag\n      FROM water_level_readings\n      WHERE well_number = ?\n    ",o=[t];a&&(i+=" AND timestamp_utc >= ?",o.push(a)),s&&(i+=" AND timestamp_utc <= ?",o.push(s)),("all"===l||"manual"===l)&&(i+=" UNION ALL\n        SELECT \n          id,\n          well_number,\n          timestamp_utc,\n          julian_timestamp,\n          water_level,\n          NULL as temperature,\n          dtw,\n          'manual' as data_source,\n          NULL as baro_flag,\n          NULL as level_flag\n        FROM manual_readings\n        WHERE well_number = ?\n      ",o.push(t),a&&(i+=" AND timestamp_utc >= ?",o.push(a)),s&&(i+=" AND timestamp_utc <= ?",o.push(s))),i+=" ORDER BY timestamp_utc";try{let e=this.db.prepare(i);e.bind(o);let t=[];for(;e.step();){let a=e.getAsObject();t.push(this.mapRowToReading(a))}if(e.free(),r&&t.length>n)return this.downsampleData(t,n);return t}catch(e){throw console.error("Error fetching water level data:",e),Error("Failed to fetch water level data")}}async getRechargeResults(e){if(!this.db)throw Error("Database not initialized");let t=this.db.prepare("\n      SELECT name FROM sqlite_master \n      WHERE type='table' AND name IN ('rise_results', 'mrc_results', 'emr_results')\n    "),a=[];for(;t.step();){let e=t.getAsObject();a.push(e.name)}if(t.free(),0===a.length)return[];let s=[];for(let t of a){let a=t.replace("_results","").toUpperCase();try{let l=this.db.prepare("\n          SELECT * FROM ".concat(t,"\n          WHERE well_number = ?\n          ORDER BY calculation_date DESC\n        "));for(l.bind([e]);l.step();){let e=l.getAsObject();s.push({...e,method:a,calculation_parameters:e.calculation_parameters?JSON.parse(e.calculation_parameters):void 0})}l.free()}catch(e){console.error("Error querying ".concat(t,":"),e)}}return s}mapRowToWell(e){return{well_number:e.well_number,cae_number:e.cae_number,well_field:e.well_field,cluster:e.cluster,latitude:e.latitude,longitude:e.longitude,top_of_casing:e.top_of_casing,ground_elevation:e.ground_elevation,well_depth:e.well_depth,screen_top:e.screen_top,screen_bottom:e.screen_bottom,aquifer_type:e.aquifer_type,static_water_level:e.static_water_level,notes:e.notes,last_reading_date:e.last_reading_date,total_readings:e.total_readings||0,has_manual_readings:!!e.has_manual_readings,has_transducer_data:!!e.has_transducer_data,has_telemetry_data:!!e.has_telemetry_data}}mapRowToReading(e){return{id:e.id,well_number:e.well_number,timestamp_utc:e.timestamp_utc,julian_timestamp:e.julian_timestamp,water_level:e.water_level,temperature:e.temperature,dtw:e.dtw,data_source:e.data_source,baro_flag:e.baro_flag,level_flag:e.level_flag,notes:e.notes}}downsampleData(e,t){if(e.length<=t)return e;let a=Math.floor(e.length/t),s=[];for(let t=0;t<e.length;t+=a)s.push(e[t]);return s[s.length-1]!==e[e.length-1]&&s.push(e[e.length-1]),s}close(){this.db&&(this.db.close(),this.db=null,this.initialized=!1)}constructor(e){this.arrayBuffer=e,this.db=null,this.initialized=!1}}class o{async loadDatabase(e,t){let a=new i(t);return await a.initialize(),this.databases.set(e,a),a}getDatabase(e){return this.databases.get(e)||null}closeDatabase(e){let t=this.databases.get(e);t&&(t.close(),this.databases.delete(e))}closeAllDatabases(){for(let[e,t]of this.databases)t.close();this.databases.clear()}constructor(){this.databases=new Map}}let c=new o}},function(e){e.O(0,[218,17,971,117,744],function(){return e(e.s=660)}),_N_E=e.O()}]);